import GameBoard from './gameboard';

export default class ModalGameBoard {
  constructor(rotation) {
    this.rotation = 'xd;';
  }

  // Create 10x10 game board
  static createModalGameBoard() {
    const modalGameBoard = document.getElementById('modal-game-board');
    modalGameBoard.classList.add('game-board');
    GameBoard.createGameBoard(modalGameBoard);
  }

  static setShipRotation() {
    this.rotation = 'vertical';
  }

  // 1 set hover length and rotation etc, then call create ship f+--
  // 2 change ship text img

  // Switch ship rotation on 'r' keydown
  static switchShipRotation() {
    const rotateButton = document.getElementById('rotate-button');
    rotateButton.addEventListener('click', () => {
      console.log('test');
    });
  }

  // Loop ship length and add hover effects on grids.
  // Set next grid's length according to rotation.
  // 10 for vertical, 1 for horizontal.
  static setGridColor(currentGrid, shipLength, rotation, color) {
    const modalGameBoard = document.getElementById('modal-game-board');

    for (let i = 1; i < shipLength; i++) {
      let nextGrid;
      rotation === 'horizontal'
        ? (nextGrid = currentGrid + i)
        : (nextGrid = currentGrid + i * 10);
      if (
        modalGameBoard.childNodes[currentGrid].style.backgroundColor !==
          'orange' &&
        modalGameBoard.childNodes[nextGrid].style.backgroundColor !== 'orange'
      ) {
        modalGameBoard.childNodes[currentGrid].style.backgroundColor = color;
        modalGameBoard.childNodes[nextGrid].style.backgroundColor = color;
      }
    }
  }

  // Highlight on hover
  static gridHoverActions(shipLength, rotation) {
    const gridAll = document.querySelectorAll('.grid');

    // Highlight current grid on 'mouseover'
    gridAll.forEach((singleGrid) => {
      singleGrid.addEventListener('mouseover', () => {
        const currentGridLength = Number(singleGrid.textContent);

        // If ship is deployable to the current grid, highlight it.
        if (GameBoard.isShipDeployable(currentGridLength, shipLength, rotation))
          this.setGridColor(
            currentGridLength,
            shipLength,
            rotation,
            'rgba(0,0,0,.5)'
          );
      });

      // Cancel highlight when 'mouseout'
      singleGrid.addEventListener('mouseout', () => {
        const currentGridLength = Number(singleGrid.textContent);
        // Check if ship deployment is legit, before trying to cancel the hover effect.
        if (GameBoard.isShipDeployable(currentGridLength, shipLength, rotation))
          this.setGridColor(currentGridLength, shipLength, rotation, 'white');
      });
    });

    // Deploy ships on click
    gridAll.forEach((singleGrid) =>
      singleGrid.addEventListener('click', () => {
        const currentGridLength = Number(singleGrid.textContent);
        // If ship is deployable to the current grid, highlight it.
        if (GameBoard.isShipDeployable(currentGridLength, shipLength, rotation))
          this.setGridColor(currentGridLength, shipLength, rotation, 'orange');
      })
    );
  }
}
